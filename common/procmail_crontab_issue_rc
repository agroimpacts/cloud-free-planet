# This script is run by .procmailrc.
# It's purpose is to redirect any error email received from the mapper, sandbox, 
# or root crontab scripts to become a GitHub alert issue.
# To configure, create a .procmailrc file in the home directory of the user account
# receiving the problem emails. It should only contain these 4 lines:
#:0
#{
#    INCLUDERC="$HOME/mapper/common/procmail_crontab_issue_rc"
#}

# And create a .forward file in the same home directory with this 1 line:
#"|IFS=' ' && exec /usr/bin/procmail -f- || exit 75 #user"

# Remove the leading '#' characters, and copy the 5 lines exactly as is.

SHELL=/bin/bash
LOGFILE=$HOME/mapper/log/procmail.log
VERBOSE=on

# Extract the sender and subject headers
:0hw
SUBJECT=|formail -c -z -xSubject:

# Copy of the message body
:0bw
BODY=|cat

# Send it to the script that creates a GitHub issue.
:0ic
|$HOME/mapper/common/tools/create_alert_issue.py "${SUBJECT}" "${BODY}"

# Archive mail to file.
:0:
$HOME/mapper/log/emails.log
