
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>An Introduction to boto’s S3 interface &mdash; boto v2.8.0-dev</title>
    <link rel="stylesheet" href="_static/boto.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     'HEAD',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="boto v2.8.0-dev" href="index.html" />
    <link rel="next" title="S3" href="ref/s3.html" />
    <link rel="prev" title="fps" href="ref/fps.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="ref/s3.html" title="S3"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ref/fps.html" title="fps"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">boto v2.8.0-dev</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="an-introduction-to-boto-s-s3-interface">
<span id="s3-tut"></span><h1>An Introduction to boto&#8217;s S3 interface<a class="headerlink" href="#an-introduction-to-boto-s-s3-interface" title="Permalink to this headline">¶</a></h1>
<p>This tutorial focuses on the boto interface to the Simple Storage Service
from Amazon Web Services.  This tutorial assumes that you have already
downloaded and installed boto.</p>
<div class="section" id="creating-a-connection">
<h2>Creating a Connection<a class="headerlink" href="#creating-a-connection" title="Permalink to this headline">¶</a></h2>
<p>The first step in accessing S3 is to create a connection to the service.
There are two ways to do this in boto.  The first is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">boto.s3.connection</span> <span class="kn">import</span> <span class="n">S3Connection</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span> <span class="o">=</span> <span class="n">S3Connection</span><span class="p">(</span><span class="s">&#39;&lt;aws access key&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;aws secret key&gt;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>At this point the variable conn will point to an S3Connection object.  In
this example, the AWS access key and AWS secret key are passed in to the
method explicitely.  Alternatively, you can set the environment variables:</p>
<ul class="simple">
<li><cite>AWS_ACCESS_KEY_ID</cite> - Your AWS Access Key ID</li>
<li><cite>AWS_SECRET_ACCESS_KEY</cite> - Your AWS Secret Access Key</li>
</ul>
<p>and then call the constructor without any arguments, like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span> <span class="o">=</span> <span class="n">S3Connection</span><span class="p">()</span>
</pre></div>
</div>
<p>There is also a shortcut function in the boto package, called connect_s3
that may provide a slightly easier means of creating a connection:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">boto</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span> <span class="o">=</span> <span class="n">boto</span><span class="o">.</span><span class="n">connect_s3</span><span class="p">()</span>
</pre></div>
</div>
<p>In either case, conn will point to an S3Connection object which we will
use throughout the remainder of this tutorial.</p>
</div>
<div class="section" id="creating-a-bucket">
<h2>Creating a Bucket<a class="headerlink" href="#creating-a-bucket" title="Permalink to this headline">¶</a></h2>
<p>Once you have a connection established with S3, you will probably want to
create a bucket.  A bucket is a container used to store key/value pairs
in S3.  A bucket can hold an unlimited amount of data so you could potentially
have just one bucket in S3 for all of your information.  Or, you could create
separate buckets for different types of data.  You can figure all of that out
later, first let&#8217;s just create a bucket.  That can be accomplished like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bucket</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">create_bucket</span><span class="p">(</span><span class="s">&#39;mybucket&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n-Identifier">?</span>
  File <span class="nb">&quot;boto/connection.py&quot;</span>, line <span class="m">285</span>, in <span class="n-Identifier">create_bucket</span>
    <span class="k">raise</span> <span class="n">S3CreateError</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span>
<span class="nc">boto.exception.S3CreateError: S3Error[409]</span>: <span class="n-Identifier">Conflict</span>
</pre></div>
</div>
<p>Whoa.  What happended there?  Well, the thing you have to know about
buckets is that they are kind of like domain names.  It&#8217;s one flat name
space that everyone who uses S3 shares.  So, someone has already create
a bucket called &#8220;mybucket&#8221; in S3 and that means no one else can grab that
bucket name.  So, you have to come up with a name that hasn&#8217;t been taken yet.
For example, something that uses a unique string as a prefix.  Your
AWS_ACCESS_KEY (NOT YOUR SECRET KEY!) could work but I&#8217;ll leave it to
your imagination to come up with something.  I&#8217;ll just assume that you
found an acceptable name.</p>
<p>The create_bucket method will create the requested bucket if it does not
exist or will return the existing bucket if it does exist.</p>
</div>
<div class="section" id="creating-a-bucket-in-another-location">
<h2>Creating a Bucket In Another Location<a class="headerlink" href="#creating-a-bucket-in-another-location" title="Permalink to this headline">¶</a></h2>
<p>The example above assumes that you want to create a bucket in the
standard US region.  However, it is possible to create buckets in
other locations.  To do so, first import the Location object from the
boto.s3.connection module, like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">boto.s3.connection</span> <span class="kn">import</span> <span class="n">Location</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">Location</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">())</span>
<span class="go">APNortheast</span>
<span class="go">APSoutheast</span>
<span class="go">APSoutheast2</span>
<span class="go">DEFAULT</span>
<span class="go">EU</span>
<span class="go">SAEast</span>
<span class="go">USWest</span>
<span class="go">USWest2</span>
</pre></div>
</div>
<p>As you can see, the Location object defines a number of possible locations.  By
default, the location is the empty string which is interpreted as the US
Classic Region, the original S3 region.  However, by specifying another
location at the time the bucket is created, you can instruct S3 to create the
bucket in that location.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span><span class="o">.</span><span class="n">create_bucket</span><span class="p">(</span><span class="s">&#39;mybucket&#39;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">Location</span><span class="o">.</span><span class="n">EU</span><span class="p">)</span>
</pre></div>
</div>
<p>will create the bucket in the EU region (assuming the name is available).</p>
</div>
<div class="section" id="storing-data">
<h2>Storing Data<a class="headerlink" href="#storing-data" title="Permalink to this headline">¶</a></h2>
<p>Once you have a bucket, presumably you will want to store some data
in it.  S3 doesn&#8217;t care what kind of information you store in your objects
or what format you use to store it.  All you need is a key that is unique
within your bucket.</p>
<p>The Key object is used in boto to keep track of data stored in S3.  To store
new data in S3, start by creating a new Key object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">boto.s3.key</span> <span class="kn">import</span> <span class="n">Key</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span> <span class="o">=</span> <span class="n">Key</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#39;foobar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span><span class="o">.</span><span class="n">set_contents_from_string</span><span class="p">(</span><span class="s">&#39;This is a test of S3&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The net effect of these statements is to create a new object in S3 with a
key of &#8220;foobar&#8221; and a value of &#8220;This is a test of S3&#8221;.  To validate that
this worked, quit out of the interpreter and start it up again.  Then:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">boto</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">boto</span><span class="o">.</span><span class="n">connect_s3</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">create_bucket</span><span class="p">(</span><span class="s">&#39;mybucket&#39;</span><span class="p">)</span> <span class="c"># substitute your bucket name here</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">boto.s3.key</span> <span class="kn">import</span> <span class="n">Key</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span> <span class="o">=</span> <span class="n">Key</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#39;foobar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span><span class="o">.</span><span class="n">get_contents_as_string</span><span class="p">()</span>
<span class="go">&#39;This is a test of S3&#39;</span>
</pre></div>
</div>
<p>So, we can definitely store and retrieve strings.  A more interesting
example may be to store the contents of a local file in S3 and then retrieve
the contents to another local file.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">k</span> <span class="o">=</span> <span class="n">Key</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#39;myfile&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span><span class="o">.</span><span class="n">set_contents_from_filename</span><span class="p">(</span><span class="s">&#39;foo.jpg&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span><span class="o">.</span><span class="n">get_contents_to_filename</span><span class="p">(</span><span class="s">&#39;bar.jpg&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>There are a couple of things to note about this.  When you send data to
S3 from a file or filename, boto will attempt to determine the correct
mime type for that file and send it as a Content-Type header.  The boto
package uses the standard mimetypes package in Python to do the mime type
guessing.  The other thing to note is that boto does stream the content
to and from S3 so you should be able to send and receive large files without
any problem.</p>
</div>
<div class="section" id="accessing-a-bucket">
<h2>Accessing A Bucket<a class="headerlink" href="#accessing-a-bucket" title="Permalink to this headline">¶</a></h2>
<p>Once a bucket exists, you can access it by getting the bucket. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mybucket</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="s">&#39;mybucket&#39;</span><span class="p">)</span> <span class="c"># Substitute in your bucket name</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mybucket</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
<span class="go">&lt;listing of keys in the bucket)</span>
</pre></div>
</div>
<p>By default, this method tries to validate the bucket&#8217;s existence. You can
override this behavior by passing <tt class="docutils literal"><span class="pre">validate=False</span></tt>.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">nonexistent</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="s">&#39;i-dont-exist-at-all&#39;</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>If the bucket does not exist, a <tt class="docutils literal"><span class="pre">S3ResponseError</span></tt> will commonly be thrown. If
you&#8217;d rather not deal with any exceptions, you can use the <tt class="docutils literal"><span class="pre">lookup</span></tt> method.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">nonexistent</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s">&#39;i-dont-exist-at-all&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">nonexistent</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="s">&quot;No such bucket!&quot;</span>
<span class="gp">...</span>
<span class="go">No such bucket!</span>
</pre></div>
</div>
</div>
<div class="section" id="deleting-a-bucket">
<h2>Deleting A Bucket<a class="headerlink" href="#deleting-a-bucket" title="Permalink to this headline">¶</a></h2>
<p>Removing a bucket can be done using the <tt class="docutils literal"><span class="pre">delete_bucket</span></tt> method. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span><span class="o">.</span><span class="n">delete_bucket</span><span class="p">(</span><span class="s">&#39;mybucket&#39;</span><span class="p">)</span> <span class="c"># Substitute in your bucket name</span>
</pre></div>
</div>
<p>The bucket must be empty of keys or this call will fail &amp; an exception will be
raised. You can remove a non-empty bucket by doing something like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">full_bucket</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="s">&#39;bucket-to-delete&#39;</span><span class="p">)</span>
<span class="go"># It&#39;s full of keys. Delete them all.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">full_bucket</span><span class="o">.</span><span class="n">list</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">key</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
<span class="gp">...</span>
<span class="go"># The bucket is empty now. Delete it.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span><span class="o">.</span><span class="n">delete_bucket</span><span class="p">(</span><span class="s">&#39;bucket-to-delete&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>This method can cause data loss! Be very careful when using it.</p>
<p class="last">Additionally, be aware that using the above method for removing all keys
and deleting the bucket involves a request for each key. As such, it&#8217;s not
particularly fast &amp; is very chatty.</p>
</div>
</div>
<div class="section" id="listing-all-available-buckets">
<h2>Listing All Available Buckets<a class="headerlink" href="#listing-all-available-buckets" title="Permalink to this headline">¶</a></h2>
<p>In addition to accessing specific buckets via the create_bucket method
you can also get a list of all available buckets that you have created.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get_all_buckets</span><span class="p">()</span>
</pre></div>
</div>
<p>This returns a ResultSet object (see the SQS Tutorial for more info on
ResultSet objects).  The ResultSet can be used as a sequence or list type
object to retrieve Bucket objects.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">rs</span><span class="p">)</span>
<span class="go">11</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">rs</span><span class="p">:</span>
<span class="gp">... </span><span class="k">print</span> <span class="n">b</span><span class="o">.</span><span class="n">name</span>
<span class="gp">...</span>
<span class="go">&lt;listing of available buckets&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">rs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-getting-the-access-control-list-for-buckets-and-keys">
<h2>Setting / Getting the Access Control List for Buckets and Keys<a class="headerlink" href="#setting-getting-the-access-control-list-for-buckets-and-keys" title="Permalink to this headline">¶</a></h2>
<p>The S3 service provides the ability to control access to buckets and keys
within s3 via the Access Control List (ACL) associated with each object in
S3.  There are two ways to set the ACL for an object:</p>
<ol class="arabic simple">
<li>Create a custom ACL that grants specific rights to specific users.  At the
moment, the users that are specified within grants have to be registered
users of Amazon Web Services so this isn&#8217;t as useful or as general as it
could be.</li>
<li>Use a &#8220;canned&#8221; access control policy.  There are four canned policies
defined:<ol class="loweralpha">
<li>private: Owner gets FULL_CONTROL.  No one else has any access rights.</li>
<li>public-read: Owners gets FULL_CONTROL and the anonymous principal is granted READ access.</li>
<li>public-read-write: Owner gets FULL_CONTROL and the anonymous principal is granted READ and WRITE access.</li>
<li>authenticated-read: Owner gets FULL_CONTROL and any principal authenticated as a registered Amazon S3 user is granted READ access.</li>
</ol>
</li>
</ol>
<p>To set a canned ACL for a bucket, use the set_acl method of the Bucket object.
The argument passed to this method must be one of the four permissable
canned policies named in the list CannedACLStrings contained in acl.py.
For example, to make a bucket readable by anyone:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">set_acl</span><span class="p">(</span><span class="s">&#39;public-read&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can also set the ACL for Key objects, either by passing an additional
argument to the above method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">set_acl</span><span class="p">(</span><span class="s">&#39;public-read&#39;</span><span class="p">,</span> <span class="s">&#39;foobar&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>where &#8216;foobar&#8217; is the key of some object within the bucket b or you can
call the set_acl method of the Key object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">k</span><span class="o">.</span><span class="n">set_acl</span><span class="p">(</span><span class="s">&#39;public-read&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can also retrieve the current ACL for a Bucket or Key object using the
get_acl object.  This method parses the AccessControlPolicy response sent
by S3 and creates a set of Python objects that represent the ACL.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">acp</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_acl</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">acp</span>
<span class="go">&lt;boto.acl.Policy instance at 0x2e6940&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">acp</span><span class="o">.</span><span class="n">acl</span>
<span class="go">&lt;boto.acl.ACL instance at 0x2e69e0&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">acp</span><span class="o">.</span><span class="n">acl</span><span class="o">.</span><span class="n">grants</span>
<span class="go">[&lt;boto.acl.Grant instance at 0x2e6a08&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">grant</span> <span class="ow">in</span> <span class="n">acp</span><span class="o">.</span><span class="n">acl</span><span class="o">.</span><span class="n">grants</span><span class="p">:</span>
<span class="gp">... </span>  <span class="k">print</span> <span class="n">grant</span><span class="o">.</span><span class="n">permission</span><span class="p">,</span> <span class="n">grant</span><span class="o">.</span><span class="n">display_name</span><span class="p">,</span> <span class="n">grant</span><span class="o">.</span><span class="n">email_address</span><span class="p">,</span> <span class="n">grant</span><span class="o">.</span><span class="n">id</span>
<span class="gp">...</span>
<span class="go">FULL_CONTROL &lt;boto.user.User instance at 0x2e6a30&gt;</span>
</pre></div>
</div>
<p>The Python objects representing the ACL can be found in the acl.py module
of boto.</p>
<p>Both the Bucket object and the Key object also provide shortcut
methods to simplify the process of granting individuals specific
access.  For example, if you want to grant an individual user READ
access to a particular object in S3 you could do the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">key</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s">&#39;mykeytoshare&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">key</span><span class="o">.</span><span class="n">add_email_grant</span><span class="p">(</span><span class="s">&#39;READ&#39;</span><span class="p">,</span> <span class="s">&#39;foo@bar.com&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The email address provided should be the one associated with the users
AWS account.  There is a similar method called add_user_grant that accepts the
canonical id of the user rather than the email address.</p>
</div>
<div class="section" id="setting-getting-metadata-values-on-key-objects">
<h2>Setting/Getting Metadata Values on Key Objects<a class="headerlink" href="#setting-getting-metadata-values-on-key-objects" title="Permalink to this headline">¶</a></h2>
<p>S3 allows arbitrary user metadata to be assigned to objects within a bucket.
To take advantage of this S3 feature, you should use the set_metadata and
get_metadata methods of the Key object to set and retrieve metadata associated
with an S3 object.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">k</span> <span class="o">=</span> <span class="n">Key</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#39;has_metadata&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s">&#39;meta1&#39;</span><span class="p">,</span> <span class="s">&#39;This is the first metadata value&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s">&#39;meta2&#39;</span><span class="p">,</span> <span class="s">&#39;This is the second metadata value&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span><span class="o">.</span><span class="n">set_contents_from_filename</span><span class="p">(</span><span class="s">&#39;foo.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This code associates two metadata key/value pairs with the Key k.  To retrieve
those values later:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">k</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_key</span><span class="p">(</span><span class="s">&#39;has_metadata&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s">&#39;meta1&#39;</span><span class="p">)</span>
<span class="go">&#39;This is the first metadata value&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s">&#39;meta2&#39;</span><span class="p">)</span>
<span class="go">&#39;This is the second metadata value&#39;</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-getting-deleting-cors-configuration-on-a-bucket">
<h2>Setting/Getting/Deleting CORS Configuration on a Bucket<a class="headerlink" href="#setting-getting-deleting-cors-configuration-on-a-bucket" title="Permalink to this headline">¶</a></h2>
<p>Cross-origin resource sharing (CORS) defines a way for client web
applications that are loaded in one domain to interact with resources
in a different domain. With CORS support in Amazon S3, you can build
rich client-side web applications with Amazon S3 and selectively allow
cross-origin access to your Amazon S3 resources.</p>
<p>To create a CORS configuration and associate it with a bucket:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">boto.s3.cors</span> <span class="kn">import</span> <span class="n">CORSConfiguration</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cors_cfg</span> <span class="o">=</span> <span class="n">CORSConfiguration</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cors_cfg</span><span class="o">.</span><span class="n">add_rule</span><span class="p">([</span><span class="s">&#39;PUT&#39;</span><span class="p">,</span> <span class="s">&#39;POST&#39;</span><span class="p">,</span> <span class="s">&#39;DELETE&#39;</span><span class="p">],</span> <span class="s">&#39;https://www.example.com&#39;</span><span class="p">,</span> <span class="n">allowed_header</span><span class="o">=</span><span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">max_age_seconds</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">expose_header</span><span class="o">=</span><span class="s">&#39;x-amz-server-side-encryption&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cors_cfg</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="s">&#39;GET&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The above code creates a CORS configuration object with two rules.</p>
<ul class="simple">
<li>The first rule allows cross-origin PUT, POST, and DELETE requests from
the <a class="reference external" href="https://www.example.com/">https://www.example.com/</a> origin.  The rule also allows all headers
in preflight OPTIONS request through the Access-Control-Request-Headers
header.  In response to any preflight OPTIONS request, Amazon S3 will
return any requested headers.</li>
<li>The second rule allows cross-origin GET requests from all origins.</li>
</ul>
<p>To associate this configuration with a bucket:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">boto</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">boto</span><span class="o">.</span><span class="n">connect_s3</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bucket</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s">&#39;mybucket&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bucket</span><span class="o">.</span><span class="n">set_cors</span><span class="p">(</span><span class="n">cors_cfg</span><span class="p">)</span>
</pre></div>
</div>
<p>To retrieve the CORS configuration associated with a bucket:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">cors_cfg</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">get_cors</span><span class="p">()</span>
</pre></div>
</div>
<p>And, finally, to delete all CORS configurations from a bucket:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bucket</span><span class="o">.</span><span class="n">delete_cors</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="transitioning-objects-to-glacier">
<h2>Transitioning Objects to Glacier<a class="headerlink" href="#transitioning-objects-to-glacier" title="Permalink to this headline">¶</a></h2>
<p>You can configure objects in S3 to transition to Glacier after a period of
time.  This is done using lifecycle policies.  A lifecycle policy can also
specify that an object should be deleted after a period of time.  Lifecycle
configurations are assigned to buckets and require these parameters:</p>
<ul class="simple">
<li>The object prefix that identifies the objects you are targeting.</li>
<li>The action you want S3 to perform on the identified objects.</li>
<li>The date (or time period) when you want S3 to perform these actions.</li>
</ul>
<p>For example, given a bucket <tt class="docutils literal"><span class="pre">s3-glacier-boto-demo</span></tt>, we can first retrieve the
bucket:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">boto</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">boto</span><span class="o">.</span><span class="n">connect_s3</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bucket</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="s">&#39;s3-glacier-boto-demo&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then we can create a lifecycle object.  In our example, we want all objects
under <tt class="docutils literal"><span class="pre">logs/*</span></tt> to transition to Glacier 30 days after the object is created.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">boto.s3.lifecycle</span> <span class="kn">import</span> <span class="n">Lifecycle</span><span class="p">,</span> <span class="n">Transition</span><span class="p">,</span> <span class="n">Rule</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">to_glacier</span> <span class="o">=</span> <span class="n">Transition</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">storage_class</span><span class="o">=</span><span class="s">&#39;GLACIER&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rule</span> <span class="o">=</span> <span class="n">Rule</span><span class="p">(</span><span class="s">&#39;ruleid&#39;</span><span class="p">,</span> <span class="s">&#39;logs/&#39;</span><span class="p">,</span> <span class="s">&#39;Enabled&#39;</span><span class="p">,</span> <span class="n">transition</span><span class="o">=</span><span class="n">to_glacier</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lifecycle</span> <span class="o">=</span> <span class="n">Lifecycle</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lifecycle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For API docs for the lifecycle objects, see <a class="reference internal" href="ref/s3.html#module-boto.s3.lifecycle" title="boto.s3.lifecycle"><tt class="xref py py-mod docutils literal"><span class="pre">boto.s3.lifecycle</span></tt></a></p>
</div>
<p>We can now configure the bucket with this lifecycle policy:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bucket</span><span class="o">.</span><span class="n">configure_lifecycle</span><span class="p">(</span><span class="n">lifecycle</span><span class="p">)</span>
</pre></div>
</div>
<p>True</p>
<p>You can also retrieve the current lifecycle policy for the bucket:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">current</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">get_lifecycle_config</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transition</span>
<span class="go">&lt;Transition: in: 30 days, GLACIER&gt;</span>
</pre></div>
</div>
<p>When an object transitions to Glacier, the storage class will be
updated.  This can be seen when you <strong>list</strong> the objects in a bucket:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">bucket</span><span class="o">.</span><span class="n">list</span><span class="p">():</span>
<span class="gp">... </span>  <span class="k">print</span> <span class="n">key</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">storage_class</span>
<span class="gp">...</span>
<span class="go">&lt;Key: s3-glacier-boto-demo,logs/testlog1.log&gt; GLACIER</span>
</pre></div>
</div>
<p>You can also use the prefix argument to the <tt class="docutils literal"><span class="pre">bucket.list</span></tt> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="nb">list</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s">&#39;logs/testlog1.log&#39;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">storage_class</span>
<span class="go">u&#39;GLACIER&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="restoring-objects-from-glacier">
<h2>Restoring Objects from Glacier<a class="headerlink" href="#restoring-objects-from-glacier" title="Permalink to this headline">¶</a></h2>
<p>Once an object has been transitioned to Glacier, you can restore the object
back to S3.  To do so, you can use the <a class="reference internal" href="ref/s3.html#boto.s3.key.Key.restore" title="boto.s3.key.Key.restore"><tt class="xref py py-meth docutils literal"><span class="pre">boto.s3.key.Key.restore()</span></tt></a>
method of the key object.
The <tt class="docutils literal"><span class="pre">restore</span></tt> method takes an integer that specifies the number of days
to keep the object in S3.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">boto</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">boto</span><span class="o">.</span><span class="n">connect_s3</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bucket</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="s">&#39;s3-glacier-boto-demo&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">key</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">get_key</span><span class="p">(</span><span class="s">&#39;logs/testlog1.log&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">key</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>It takes about 4 hours for a restore operation to make a copy of the archive
available for you to access.  While the object is being restored, the
<tt class="docutils literal"><span class="pre">ongoing_restore</span></tt> attribute will be set to <tt class="xref docutils literal"><span class="pre">True</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">key</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">get_key</span><span class="p">(</span><span class="s">&#39;logs/testlog1.log&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">key</span><span class="o">.</span><span class="n">ongoing_restore</span>
<span class="go">True</span>
</pre></div>
</div>
<p>When the restore is finished, this value will be <tt class="xref docutils literal"><span class="pre">False</span></tt> and the expiry
date of the object will be non <tt class="xref docutils literal"><span class="pre">None</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">key</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">get_key</span><span class="p">(</span><span class="s">&#39;logs/testlog1.log&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">key</span><span class="o">.</span><span class="n">ongoing_restore</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">key</span><span class="o">.</span><span class="n">expiry_date</span>
<span class="go">&quot;Fri, 21 Dec 2012 00:00:00 GMT&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If there is no restore operation either in progress or completed,
the <tt class="docutils literal"><span class="pre">ongoing_restore</span></tt> attribute will be <tt class="xref docutils literal"><span class="pre">None</span></tt>.</p>
</div>
<p>Once the object is restored you can then download the contents:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">key</span><span class="o">.</span><span class="n">get_contents_to_filename</span><span class="p">(</span><span class="s">&#39;testlog1.log&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">An Introduction to boto&#8217;s S3 interface</a><ul>
<li><a class="reference internal" href="#creating-a-connection">Creating a Connection</a></li>
<li><a class="reference internal" href="#creating-a-bucket">Creating a Bucket</a></li>
<li><a class="reference internal" href="#creating-a-bucket-in-another-location">Creating a Bucket In Another Location</a></li>
<li><a class="reference internal" href="#storing-data">Storing Data</a></li>
<li><a class="reference internal" href="#accessing-a-bucket">Accessing A Bucket</a></li>
<li><a class="reference internal" href="#deleting-a-bucket">Deleting A Bucket</a></li>
<li><a class="reference internal" href="#listing-all-available-buckets">Listing All Available Buckets</a></li>
<li><a class="reference internal" href="#setting-getting-the-access-control-list-for-buckets-and-keys">Setting / Getting the Access Control List for Buckets and Keys</a></li>
<li><a class="reference internal" href="#setting-getting-metadata-values-on-key-objects">Setting/Getting Metadata Values on Key Objects</a></li>
<li><a class="reference internal" href="#setting-getting-deleting-cors-configuration-on-a-bucket">Setting/Getting/Deleting CORS Configuration on a Bucket</a></li>
<li><a class="reference internal" href="#transitioning-objects-to-glacier">Transitioning Objects to Glacier</a></li>
<li><a class="reference internal" href="#restoring-objects-from-glacier">Restoring Objects from Glacier</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="ref/fps.html"
                        title="previous chapter">fps</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="ref/s3.html"
                        title="next chapter">S3</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/s3_tut.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><div><a href="boto.pdf">PDF Version</a></div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="ref/s3.html" title="S3"
             >next</a> |</li>
        <li class="right" >
          <a href="ref/fps.html" title="fps"
             >previous</a> |</li>
        <li><a href="index.html">boto v2.8.0-dev</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009,2010, Mitch Garnaat.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.8.
    </div>
  </body>
</html>