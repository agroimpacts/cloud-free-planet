
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>An Introduction to boto’s Cloudsearch interface &mdash; boto v2.8.0-dev</title>
    <link rel="stylesheet" href="_static/boto.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     'HEAD',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="boto v2.8.0-dev" href="index.html" />
    <link rel="next" title="Cloudsearch" href="ref/cloudsearch.html" />
    <link rel="prev" title="SES" href="ref/ses.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="ref/cloudsearch.html" title="Cloudsearch"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ref/ses.html" title="SES"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">boto v2.8.0-dev</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="an-introduction-to-boto-s-cloudsearch-interface">
<h1>An Introduction to boto&#8217;s Cloudsearch interface<a class="headerlink" href="#an-introduction-to-boto-s-cloudsearch-interface" title="Permalink to this headline">¶</a></h1>
<p>This tutorial focuses on the boto interface to AWS&#8217; <a class="reference external" href="http://aws.amazon.com/cloudsearch/">Cloudsearch</a>. This tutorial
assumes that you have boto already downloaded and installed.</p>
<div class="section" id="creating-a-connection">
<h2>Creating a Connection<a class="headerlink" href="#creating-a-connection" title="Permalink to this headline">¶</a></h2>
<p>The first step in accessing CloudSearch is to create a connection to the service.</p>
<p>The recommended method of doing this is as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">boto.cloudsearch</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span> <span class="o">=</span> <span class="n">boto</span><span class="o">.</span><span class="n">cloudsearch</span><span class="o">.</span><span class="n">connect_to_region</span><span class="p">(</span><span class="s">&quot;us-east-1&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">aws_access_key_id</span><span class="o">=</span><span class="s">&#39;&lt;aws access key&#39;</span><span class="o">&gt;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="s">&#39;&lt;aws secret key&gt;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>At this point, the variable conn will point to a CloudSearch connection object
in the us-east-1 region. Currently, this is the only region which has the
CloudSearch service. In this example, the AWS access key and AWS secret key are
passed in to the method explicitly. Alternatively, you can set the environment
variables:</p>
<ul class="simple">
<li><cite>AWS_ACCESS_KEY_ID</cite> - Your AWS Access Key ID</li>
<li><cite>AWS_SECRET_ACCESS_KEY</cite> - Your AWS Secret Access Key</li>
</ul>
<p>and then simply call:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">boto.cloudsearch</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span> <span class="o">=</span> <span class="n">boto</span><span class="o">.</span><span class="n">cloudsearch</span><span class="o">.</span><span class="n">connect_to_region</span><span class="p">(</span><span class="s">&quot;us-east-1&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In either case, conn will point to the Connection object which we will use
throughout the remainder of this tutorial.</p>
</div>
<div class="section" id="creating-a-domain">
<h2>Creating a Domain<a class="headerlink" href="#creating-a-domain" title="Permalink to this headline">¶</a></h2>
<p>Once you have a connection established with the CloudSearch service, you will
want to create a domain. A domain encapsulates the data that you wish to index,
as well as indexes and metadata relating to it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">boto.cloudsearch.domain</span> <span class="kn">import</span> <span class="n">Domain</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">domain</span> <span class="o">=</span> <span class="n">Domain</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">conn</span><span class="o">.</span><span class="n">create_domain</span><span class="p">(</span><span class="s">&#39;demo&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>This domain can be used to control access policies, indexes, and the actual
document service, which you will use to index and search.</p>
</div>
<div class="section" id="setting-access-policies">
<h2>Setting access policies<a class="headerlink" href="#setting-access-policies" title="Permalink to this headline">¶</a></h2>
<p>Before you can connect to a document service, you need to set the correct
access properties.  For example, if you were connecting from 192.168.1.0, you
could give yourself access as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">our_ip</span> <span class="o">=</span> <span class="s">&#39;192.168.1.0&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c"># Allow our IP address to access the document and search services</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">policy</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">get_access_policies</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">policy</span><span class="o">.</span><span class="n">allow_search_ip</span><span class="p">(</span><span class="n">our_ip</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">policy</span><span class="o">.</span><span class="n">allow_doc_ip</span><span class="p">(</span><span class="n">our_ip</span><span class="p">)</span>
</pre></div>
</div>
<p>You can use the <a class="reference internal" href="ref/cloudsearch.html#boto.cloudsearch.optionstatus.ServicePoliciesStatus.allow_search_ip" title="boto.cloudsearch.optionstatus.ServicePoliciesStatus.allow_search_ip"><tt class="xref py py-meth docutils literal"><span class="pre">allow_search_ip</span></tt></a> and
<a class="reference internal" href="ref/cloudsearch.html#boto.cloudsearch.optionstatus.ServicePoliciesStatus.allow_doc_ip" title="boto.cloudsearch.optionstatus.ServicePoliciesStatus.allow_doc_ip"><tt class="xref py py-meth docutils literal"><span class="pre">allow_doc_ip</span></tt></a>
methods to give different CIDR blocks access to searching and the document
service respectively.</p>
</div>
<div class="section" id="creating-index-fields">
<h2>Creating index fields<a class="headerlink" href="#creating-index-fields" title="Permalink to this headline">¶</a></h2>
<p>Each domain can have up to twenty index fields which are indexed by the
CloudSearch service. For each index field, you will need to specify whether
it&#8217;s a text or integer field, as well as optionaly a default value:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># Create an &#39;text&#39; index field called &#39;username&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">uname_field</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_index_field</span><span class="p">(</span><span class="s">&#39;username&#39;</span><span class="p">,</span> <span class="s">&#39;text&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c"># Epoch time of when the user last did something</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">time_field</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_index_field</span><span class="p">(</span><span class="s">&#39;last_activity&#39;</span><span class="p">,</span>
<span class="gp">... </span>                                       <span class="s">&#39;uint&#39;</span><span class="p">,</span>
<span class="gp">... </span>                                       <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>It is also possible to mark an index field as a facet. Doing so allows a search
query to return categories into which results can be grouped, or to create
drill-down categories:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># But it would be neat to drill down into different countries</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">loc_field</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_index_field</span><span class="p">(</span><span class="s">&#39;location&#39;</span><span class="p">,</span> <span class="s">&#39;text&#39;</span><span class="p">,</span> <span class="n">facet</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, you can also mark a snippet of text as being able to be returned
directly in your search query by using the results option:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># Directly insert user snippets in our results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">snippet_field</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_index_field</span><span class="p">(</span><span class="s">&#39;snippet&#39;</span><span class="p">,</span> <span class="s">&#39;text&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>You can add up to 20 index fields in this manner:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">follower_field</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_index_field</span><span class="p">(</span><span class="s">&#39;follower_count&#39;</span><span class="p">,</span>
<span class="gp">... </span>                                           <span class="s">&#39;uint&#39;</span><span class="p">,</span>
<span class="gp">... </span>                                           <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-documents-to-the-index">
<h2>Adding Documents to the Index<a class="headerlink" href="#adding-documents-to-the-index" title="Permalink to this headline">¶</a></h2>
<p>Now, we can add some documents to our new search domain. First, you will need a
document service object through which queries are sent:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">doc_service</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">get_document_service</span><span class="p">()</span>
</pre></div>
</div>
<p>For this example, we will use a pre-populated list of sample content for our
import. You would normally pull such data from your database or another
document store:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">users</span> <span class="o">=</span> <span class="p">[</span>
<span class="go">    {</span>
<span class="go">        &#39;id&#39;: 1,</span>
<span class="go">        &#39;username&#39;: &#39;dan&#39;,</span>
<span class="go">        &#39;last_activity&#39;: 1334252740,</span>
<span class="go">        &#39;follower_count&#39;: 20,</span>
<span class="go">        &#39;location&#39;: &#39;USA&#39;,</span>
<span class="go">        &#39;snippet&#39;: &#39;Dan likes watching sunsets and rock climbing&#39;,</span>
<span class="go">    },</span>
<span class="go">    {</span>
<span class="go">        &#39;id&#39;: 2,</span>
<span class="go">        &#39;username&#39;: &#39;dankosaur&#39;,</span>
<span class="go">        &#39;last_activity&#39;: 1334252904,</span>
<span class="go">        &#39;follower_count&#39;: 1,</span>
<span class="go">        &#39;location&#39;: &#39;UK&#39;,</span>
<span class="go">        &#39;snippet&#39;: &#39;Likes to dress up as a dinosaur.&#39;,</span>
<span class="go">    },</span>
<span class="go">    {</span>
<span class="go">        &#39;id&#39;: 3,</span>
<span class="go">        &#39;username&#39;: &#39;danielle&#39;,</span>
<span class="go">        &#39;last_activity&#39;: 1334252969,</span>
<span class="go">        &#39;follower_count&#39;: 100,</span>
<span class="go">        &#39;location&#39;: &#39;DE&#39;,</span>
<span class="go">        &#39;snippet&#39;: &#39;Just moved to Germany!&#39;</span>
<span class="go">    },</span>
<span class="go">    {</span>
<span class="go">        &#39;id&#39;: 4,</span>
<span class="go">        &#39;username&#39;: &#39;daniella&#39;,</span>
<span class="go">        &#39;last_activity&#39;: 1334253279,</span>
<span class="go">        &#39;follower_count&#39;: 7,</span>
<span class="go">        &#39;location&#39;: &#39;USA&#39;,</span>
<span class="go">        &#39;snippet&#39;: &#39;Just like Dan, I like to watch a good sunset, but heights scare me.&#39;,</span>
<span class="go">    }</span>
<span class="go">]</span>
</pre></div>
</div>
<p>When adding documents to our document service, we will batch them together. You
can schedule a document to be added by using the <a class="reference internal" href="ref/cloudsearch.html#boto.cloudsearch.document.DocumentServiceConnection.add" title="boto.cloudsearch.document.DocumentServiceConnection.add"><tt class="xref py py-meth docutils literal"><span class="pre">add</span></tt></a> method. Whenever you are adding a
document, you must provide a unique ID, a version ID, and the actual document
to be indexed. In this case, we are using the user ID as our unique ID. The
version ID is used to determine which is the latest version of an object to be
indexed. If you wish to update a document, you must use a higher version ID. In
this case, we are using the time of the user&#8217;s last activity as a version
number:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">doc_service</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span> <span class="n">user</span><span class="p">[</span><span class="s">&#39;last_activity&#39;</span><span class="p">],</span> <span class="n">user</span><span class="p">)</span>
</pre></div>
</div>
<p>When you are ready to send the batched request to the document service, you can
do with the <a class="reference internal" href="ref/cloudsearch.html#boto.cloudsearch.document.DocumentServiceConnection.commit" title="boto.cloudsearch.document.DocumentServiceConnection.commit"><tt class="xref py py-meth docutils literal"><span class="pre">commit</span></tt></a> method. Note that
cloudsearch will charge per 1000 batch uploads. Each batch upload must be under
5MB:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">doc_service</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
<p>The result is an instance of <a class="reference internal" href="ref/cloudsearch.html#boto.cloudsearch.document.CommitResponse" title="boto.cloudsearch.document.CommitResponse"><tt class="xref py py-class docutils literal"><span class="pre">CommitResponse</span></tt></a> which will make the plain
dictionary response a nice object (ie result.adds, result.deletes) and raise an
exception for us if all of our documents weren&#8217;t actually committed.</p>
<p>After you have successfully committed some documents to cloudsearch, you must
use <a class="reference internal" href="ref/cloudsearch.html#boto.cloudsearch.document.DocumentServiceConnection.clear_sdf" title="boto.cloudsearch.document.DocumentServiceConnection.clear_sdf"><tt class="xref py py-meth docutils literal"><span class="pre">clear_sdf</span></tt></a>, if you wish
to use the same document service connection again so that its internal cache is
cleared.</p>
</div>
<div class="section" id="searching-documents">
<h2>Searching Documents<a class="headerlink" href="#searching-documents" title="Permalink to this headline">¶</a></h2>
<p>Now, let&#8217;s try performing a search. First, we will need a
SearchServiceConnection:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">search_service</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">get_search_service</span><span class="p">()</span>
</pre></div>
</div>
<p>A standard search will return documents which contain the exact words being
searched for:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">results</span> <span class="o">=</span> <span class="n">search_service</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="s">&quot;dan&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">results</span><span class="o">.</span><span class="n">hits</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span> <span class="n">results</span><span class="p">)</span>
<span class="go">[u&#39;1&#39;, u&#39;4&#39;]</span>
</pre></div>
</div>
<p>The standard search does not look at word order:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">results</span> <span class="o">=</span> <span class="n">search_service</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="s">&quot;dinosaur dress&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">results</span><span class="o">.</span><span class="n">hits</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span> <span class="n">results</span><span class="p">)</span>
<span class="go">[u&#39;2&#39;]</span>
</pre></div>
</div>
<p>It&#8217;s also possible to do more complex queries using the bq argument (Boolean
Query). When you are using bq, your search terms must be enclosed in single
quotes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">results</span> <span class="o">=</span> <span class="n">search_service</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">bq</span><span class="o">=</span><span class="s">&quot;&#39;dan&#39;&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">results</span><span class="o">.</span><span class="n">hits</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span> <span class="n">results</span><span class="p">)</span>
<span class="go">[u&#39;1&#39;, u&#39;4&#39;]</span>
</pre></div>
</div>
<p>When you are using boolean queries, it&#8217;s also possible to use wildcards to
extend your search to all words which start with your search terms:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">results</span> <span class="o">=</span> <span class="n">search_service</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">bq</span><span class="o">=</span><span class="s">&quot;&#39;dan*&#39;&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">results</span><span class="o">.</span><span class="n">hits</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span> <span class="n">results</span><span class="p">)</span>
<span class="go">[u&#39;1&#39;, u&#39;2&#39;, u&#39;3&#39;, u&#39;4&#39;]</span>
</pre></div>
</div>
<p>The boolean query also allows you to create more complex queries. You can OR
term together using &#8220;|&#8221;, AND terms together using &#8220;+&#8221; or a space, and you can
remove words from the query using the &#8220;-&#8221; operator:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">results</span> <span class="o">=</span> <span class="n">search_service</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">bq</span><span class="o">=</span><span class="s">&quot;&#39;watched|moved&#39;&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">results</span><span class="o">.</span><span class="n">hits</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span> <span class="n">results</span><span class="p">)</span>
<span class="go">[u&#39;3&#39;, u&#39;4&#39;]</span>
</pre></div>
</div>
<p>By default, the search will return 10 terms but it is possible to adjust this
by using the size argument as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">results</span> <span class="o">=</span> <span class="n">search_service</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">bq</span><span class="o">=</span><span class="s">&quot;&#39;dan*&#39;&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">results</span><span class="o">.</span><span class="n">hits</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span> <span class="n">results</span><span class="p">)</span>
<span class="go">[u&#39;1&#39;, u&#39;2&#39;]</span>
</pre></div>
</div>
<p>It is also possible to offset the start of the search by using the start
argument as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">results</span> <span class="o">=</span> <span class="n">search_service</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">bq</span><span class="o">=</span><span class="s">&quot;&#39;dan*&#39;&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">results</span><span class="o">.</span><span class="n">hits</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span> <span class="n">results</span><span class="p">)</span>
<span class="go">[u&#39;3&#39;, u&#39;4&#39;]</span>
</pre></div>
</div>
</div>
<div class="section" id="ordering-search-results-and-rank-expressions">
<h2>Ordering search results and rank expressions<a class="headerlink" href="#ordering-search-results-and-rank-expressions" title="Permalink to this headline">¶</a></h2>
<p>If your search query is going to return many results, it is good to be able to
sort them. You can order your search results by using the rank argument. You are
able to sort on any fields which have the results option turned on:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">results</span> <span class="o">=</span> <span class="n">search_service</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">bq</span><span class="o">=</span><span class="n">query</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;-follower_count&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>You can also create your own rank expressions to sort your results according to
other criteria, such as showing most recently active user, or combining the
recency score with the text_relevance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">domain</span><span class="o">.</span><span class="n">create_rank_expression</span><span class="p">(</span><span class="s">&#39;recently_active&#39;</span><span class="p">,</span> <span class="s">&#39;last_activity&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">domain</span><span class="o">.</span><span class="n">create_rank_expression</span><span class="p">(</span><span class="s">&#39;activish&#39;</span><span class="p">,</span>
<span class="gp">... </span>  <span class="s">&#39;text_relevance + ((follower_count/(time() - last_activity))*1000)&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">results</span> <span class="o">=</span> <span class="n">search_service</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">bq</span><span class="o">=</span><span class="n">query</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;-recently_active&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="viewing-and-adjusting-stemming-for-a-domain">
<h2>Viewing and Adjusting Stemming for a Domain<a class="headerlink" href="#viewing-and-adjusting-stemming-for-a-domain" title="Permalink to this headline">¶</a></h2>
<p>A stemming dictionary maps related words to a common stem. A stem is
typically the root or base word from which variants are derived. For
example, run is the stem of running and ran. During indexing, Amazon
CloudSearch uses the stemming dictionary when it performs
text-processing on text fields. At search time, the stemming
dictionary is used to perform text-processing on the search
request. This enables matching on variants of a word. For example, if
you map the term running to the stem run and then search for running,
the request matches documents that contain run as well as running.</p>
<p>To get the current stemming dictionary defined for a domain, use the
<a class="reference internal" href="ref/cloudsearch.html#boto.cloudsearch.domain.Domain.get_stemming" title="boto.cloudsearch.domain.Domain.get_stemming"><tt class="xref py py-meth docutils literal"><span class="pre">get_stemming</span></tt></a> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stems</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">get_stemming</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stems</span>
<span class="go">{u&#39;stems&#39;: {}}</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>This returns a dictionary object that can be manipulated directly to
add additional stems for your search domain by adding pairs of term:stem
to the stems dictionary:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stems</span><span class="p">[</span><span class="s">&#39;stems&#39;</span><span class="p">][</span><span class="s">&#39;running&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;run&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stems</span><span class="p">[</span><span class="s">&#39;stems&#39;</span><span class="p">][</span><span class="s">&#39;ran&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;run&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stems</span>
<span class="go">{u&#39;stems&#39;: {u&#39;ran&#39;: u&#39;run&#39;, u&#39;running&#39;: u&#39;run&#39;}}</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>This has changed the value locally.  To update the information in
Amazon CloudSearch, you need to save the data:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stems</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>You can also access certain CloudSearch-specific attributes related to
the stemming dictionary defined for your domain:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stems</span><span class="o">.</span><span class="n">status</span>
<span class="go">u&#39;RequiresIndexDocuments&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stems</span><span class="o">.</span><span class="n">creation_date</span>
<span class="go">u&#39;2012-05-01T12:12:32Z&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stems</span><span class="o">.</span><span class="n">update_date</span>
<span class="go">u&#39;2012-05-01T12:12:32Z&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stems</span><span class="o">.</span><span class="n">update_version</span>
<span class="go">19</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>The status indicates that, because you have changed the stems associated
with the domain, you will need to re-index the documents in the domain
before the new stems are used.</p>
</div>
<div class="section" id="viewing-and-adjusting-stopwords-for-a-domain">
<h2>Viewing and Adjusting Stopwords for a Domain<a class="headerlink" href="#viewing-and-adjusting-stopwords-for-a-domain" title="Permalink to this headline">¶</a></h2>
<p>Stopwords are words that should typically be ignored both during
indexing and at search time because they are either insignificant or
so common that including them would result in a massive number of
matches.</p>
<p>To view the stopwords currently defined for your domain, use the
<a class="reference internal" href="ref/cloudsearch.html#boto.cloudsearch.domain.Domain.get_stopwords" title="boto.cloudsearch.domain.Domain.get_stopwords"><tt class="xref py py-meth docutils literal"><span class="pre">get_stopwords</span></tt></a> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stopwords</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">get_stopwords</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stopwords</span>
<span class="go">{u&#39;stopwords&#39;: [u&#39;a&#39;,</span>
<span class="go"> u&#39;an&#39;,</span>
<span class="go"> u&#39;and&#39;,</span>
<span class="go"> u&#39;are&#39;,</span>
<span class="go"> u&#39;as&#39;,</span>
<span class="go"> u&#39;at&#39;,</span>
<span class="go"> u&#39;be&#39;,</span>
<span class="go"> u&#39;but&#39;,</span>
<span class="go"> u&#39;by&#39;,</span>
<span class="go"> u&#39;for&#39;,</span>
<span class="go"> u&#39;in&#39;,</span>
<span class="go"> u&#39;is&#39;,</span>
<span class="go"> u&#39;it&#39;,</span>
<span class="go"> u&#39;of&#39;,</span>
<span class="go"> u&#39;on&#39;,</span>
<span class="go"> u&#39;or&#39;,</span>
<span class="go"> u&#39;the&#39;,</span>
<span class="go"> u&#39;to&#39;,</span>
<span class="go"> u&#39;was&#39;]}</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>You can add additional stopwords by simply appending the values to the
list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stopwords</span><span class="p">[</span><span class="s">&#39;stopwords&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stopwords</span><span class="p">[</span><span class="s">&#39;stopwords&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;bar&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stopwords</span>
</pre></div>
</div>
<p>Similarly, you could remove currently defined stopwords from the list.
To save the changes, use the <a class="reference internal" href="ref/cloudsearch.html#boto.cloudsearch.optionstatus.OptionStatus.save" title="boto.cloudsearch.optionstatus.OptionStatus.save"><tt class="xref py py-meth docutils literal"><span class="pre">save</span></tt></a> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stopwords</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>The stopwords object has similar attributes defined above for stemming
that provide additional information about the stopwords in your domain.</p>
</div>
<div class="section" id="id1">
<h2>Viewing and Adjusting Stopwords for a Domain<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>You can configure synonyms for terms that appear in the data you are
searching. That way, if a user searches for the synonym rather than
the indexed term, the results will include documents that contain the
indexed term.</p>
<p>If you want two terms to match the same documents, you must define
them as synonyms of each other. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cat</span><span class="p">,</span> <span class="n">feline</span>
<span class="n">feline</span><span class="p">,</span> <span class="n">cat</span>
</pre></div>
</div>
<p>To view the synonyms currently defined for your domain, use the
<a class="reference internal" href="ref/cloudsearch.html#boto.cloudsearch.domain.Domain.get_synonyms" title="boto.cloudsearch.domain.Domain.get_synonyms"><tt class="xref py py-meth docutils literal"><span class="pre">get_synonyms</span></tt></a> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">synonyms</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">get_synonyms</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">synonyms</span>
<span class="go">{u&#39;synonyms&#39;: {}}</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>You can define new synonyms by adding new term:synonyms entries to the
synonyms dictionary object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">synonyms</span><span class="p">[</span><span class="s">&#39;synonyms&#39;</span><span class="p">][</span><span class="s">&#39;cat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;feline&#39;</span><span class="p">,</span> <span class="s">&#39;kitten&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">synonyms</span><span class="p">[</span><span class="s">&#39;synonyms&#39;</span><span class="p">][</span><span class="s">&#39;dog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;canine&#39;</span><span class="p">,</span> <span class="s">&#39;puppy&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>To save the changes, use the <a class="reference internal" href="ref/cloudsearch.html#boto.cloudsearch.optionstatus.OptionStatus.save" title="boto.cloudsearch.optionstatus.OptionStatus.save"><tt class="xref py py-meth docutils literal"><span class="pre">save</span></tt></a> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">synonyms</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>The synonyms object has similar attributes defined above for stemming
that provide additional information about the stopwords in your domain.</p>
</div>
<div class="section" id="deleting-documents">
<h2>Deleting Documents<a class="headerlink" href="#deleting-documents" title="Permalink to this headline">¶</a></h2>
<p>It is also possible to delete documents:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">time</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">doc_service</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">get_document_service</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c"># Again we&#39;ll cheat and use the current epoch time as our version number</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">doc_service</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">service</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">An Introduction to boto&#8217;s Cloudsearch interface</a><ul>
<li><a class="reference internal" href="#creating-a-connection">Creating a Connection</a></li>
<li><a class="reference internal" href="#creating-a-domain">Creating a Domain</a></li>
<li><a class="reference internal" href="#setting-access-policies">Setting access policies</a></li>
<li><a class="reference internal" href="#creating-index-fields">Creating index fields</a></li>
<li><a class="reference internal" href="#adding-documents-to-the-index">Adding Documents to the Index</a></li>
<li><a class="reference internal" href="#searching-documents">Searching Documents</a></li>
<li><a class="reference internal" href="#ordering-search-results-and-rank-expressions">Ordering search results and rank expressions</a></li>
<li><a class="reference internal" href="#viewing-and-adjusting-stemming-for-a-domain">Viewing and Adjusting Stemming for a Domain</a></li>
<li><a class="reference internal" href="#viewing-and-adjusting-stopwords-for-a-domain">Viewing and Adjusting Stopwords for a Domain</a></li>
<li><a class="reference internal" href="#id1">Viewing and Adjusting Stopwords for a Domain</a></li>
<li><a class="reference internal" href="#deleting-documents">Deleting Documents</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="ref/ses.html"
                        title="previous chapter">SES</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="ref/cloudsearch.html"
                        title="next chapter">Cloudsearch</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/cloudsearch_tut.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><div><a href="boto.pdf">PDF Version</a></div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="ref/cloudsearch.html" title="Cloudsearch"
             >next</a> |</li>
        <li class="right" >
          <a href="ref/ses.html" title="SES"
             >previous</a> |</li>
        <li><a href="index.html">boto v2.8.0-dev</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009,2010, Mitch Garnaat.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.8.
    </div>
  </body>
</html>